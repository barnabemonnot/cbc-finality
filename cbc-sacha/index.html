<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="general.css"/>
    <link rel="stylesheet" type="text/css" href="index.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
    <script src="libs/katex/katex.min.js"></script>
    <script src="libs/underscore.min.js"></script>
    <script src="libs/react.development.js"></script>
    <script src="libs/react-dom.development.js"></script>
    <script src="libs/d3v4+jetpack.js"></script>
    <script src="libs/graph-scroll.js"></script>
    <script src="hack.js"></script>
    <script src="src/component-library.js"></script>
  </head>
  <body>
    <div class="document-container">
      <div class="title-container">
        <div class="title">
          Finality in CBC Casper
        </div>
        <div class="sub-title">
      	  Checking for finality in a set of messages.
      	</div>
      </div>

      <section class="abstract">
        On to the finals!!!
      </section>

      <div id="toc-author-block" style="display: flex">
        <div id="authors"></div>
        <div id="toc"></div>
      </div>
    </div>
    <div>
      <div class="introduction">
	<div>
	  <h2>Here is the problem</h2>
	  In blockchains we care about adding some notion of “finality” - the idea that some block can be so firmly established in the chain that it cannot be overtaken by a competing block unless a very large portion (eg. 1/4) of validators commit a uniquely attributable fault - act in some way which is clearly and cryptographically verifiably malicious.
	</div>

	<div>
	  <h2>Here's why it's interesting</h2>
	  Finality is a very significant advancement: once a block is finalized, it is secure regardless of network latency (unlike confirmations in PoW), and reverting the block requires >= x% of validators to cheat in a way that's detectable and can be used to destroy their deposits.
	  <p>
	    There are many different approaches to finality, but the two important ones within the ethereum ecosystem are Casper FFG and Casper CBC. Here we'll be focusing on CBC
	  </p>
	</div>

	<div>
	  <h2>What exactly are we focusing on?</h2>
	  Specifically, we'll be implementing a finality oracle -- a set of heuristics that allow us to detect some of the cases where a block is final under CBC Casper.
	  <p>
	    But before we do that, let's take a look at why finality is not trivial to detect.
	  </p>

	</div>


      </div>

      <div class="scroll-container">
	<div id="graph">
	  <svg id="intro-svg" viewBox="0 0 400 300"></svg>
	</div>

	<div id="scroll-sections">

	  <div class="epoch">
	  </div>

	  <div class="epoch">
	  </div>

	  <div class="epoch">
	  </div>

	  <div class="epoch">
	  </div>

	  <div class="epoch">
	  </div>

	  <div class="epoch">
	  </div>


	  <div class="epoch">
	  </div>

	  <div class="epoch">
	  </div>

	</div>
      </div>
    </div>

    <div class="document-container">
      <div class="section-title section-label">
        The finality test
      </div>

      <div class="section-sub-title section-label">
        A simple test
      </div>

      <div class="content">
        The introduction presented a situation where validators cannot agree while all are honest and a majority exists. We then require the following property: for all validators to agree on a value, and acknowledge that they have seen everyone agree with that value. In the following, we present a test to detect the presence of a <strong>quorum</strong> of validators satisfying this property.
      </div>

      <div class="content">
        Let us introduce the objects in our discussion. Validators send messages <span class="math">m</span>, with the general pattern of a message given by <span class="math">m = (c, v, \sigma)</span>, with:
      	  <ul>
            <li><strong>The estimate</strong> <span class="math">c</span>: a consensus value among all possible values <span class="math">\mathcal{C}</span>. In this article, we consider only binary consensus, where <span class="math">\mathcal{C} = \{ 0, 1 \}.</span></li>
      	    <li><strong>The sender</strong> <span class="math">v</span>: a reference to a validator from the set <span class="math">\mathcal{V}</span>.</li>
      	    <li><strong>The justification</strong> <span class="math">\sigma</span>: a reference to some protocol state <span class="math">\sigma</span>, i.e., a set of messages that the validator acknowledges.</li>
      </div>

      <div class="content">
        We would be happy to find, for an integer <span class="math">q</span>, a set of validators where each validator from that set
        <ol>
          <li>Estimates the same consensus value <span class="math">c</span>.</li>
          <li>Has acknowledged that (i.e., included in its justification) at least <span class="math">q</span> other validators from that set has estimated <span class="math">c</span>.</li>
          <li>These included validators have kept on estimating the value<span class="math">c</span>.</li>
        </ol>
      </div>

      <div class="content">
        Suppose we have the following bipartite graph, where we trace an edge between two validators <span class="math">A</span> and <span class="math">B</span> if <span class="math">A</span> has included a message from <span class="math">B</span> in its latest justification where <span class="math">B</span> estimates the same value as <span class="math">A</span>.
      </div>

      <div id="img-four-validators"></div>
      	<script>
      	ReactDOM.render(
      	  React.createElement(
      	    StaticImage, {
      	      src: 'img/simpletest.png',
      	      name: 'The acknowledgement graph of 4 validators.'
      	    },
            "In this graph, a validator ",
            e("span", { className: "math" }, "x"),
            " on the left connects to a validator y on the right if x has acknowledged in its latest justification a message from y which estimates the same value as x's."
      	  ), document.querySelector('#img-four-validators')
      	);
      	</script>
    </div>

    <script>
    let authorData = [{
      name: "Aditya Asgaonkar",
      affiliation: "Ethereum Foundation"
    }, {
        name: "Barnabé Monnot",
        affiliation: "hackingresear.ch"
      }, {
        name: "Sacha Yves Saint-Léger",
        affiliation: "hackingresear.ch"
      }]
      </script>
      <script src="src/authorFormatting.js"></script>
      <script src="src/sectionFormatting.js"></script>
      <script src="src/referencesFormatting.js"></script>
      <script src="src/figureFormatting.js"></script>
      <script src="src/mathFormatting.js"></script>
  </body>
</html>
